<!DOCTYPE html>
<html lang="id">
<head>
<!-- ===== PWA & ICON ===== -->
<link rel="icon" type="image/png" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a56db">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pesanan - Alkes PKY</title>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap">

<style>
/* ===== GLOBAL ===== */
body{
    margin:0;
  font-family:'Inter',sans-serif;
  background:#e9f2ff;
  padding:15px;
  padding-top:120px;
}

/* ===== HEADER ===== */
.app-header {
  position:fixed;
  top:0;left:0;right:0;
  background:#fff;
  display:flex;
  flex-direction:column;
  padding:10px 12px 0;
  border-bottom:1px solid #e5e7eb;
  z-index:1000;
}

.app-brand{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:600;
  color:#1a56db;
  margin-bottom:6px;
}

.app-brand img{ height:32px; }
.app-menu{ display:flex; }
.app-menu a{
  flex:1;
  padding:10px 0;
  text-align:center;
  text-decoration:none;
  color:#64748b;
  font-size:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
}
.app-menu a svg{
  width:20px;height:20px;
  stroke:currentColor;
  fill:none;
  stroke-width:2;
}
.app-menu a.active{
  color:#1a56db;
  border-bottom:3px solid #1a56db;
}

/* ===== CARD ===== */
.card{
  background: #fff;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 3px 10px rgba(0,0,0,.1);
  margin: 15px;
}

.card h3{
  margin: 0 0 12px;
  color: #1a56db;
}

/* ===== FORM ===== */
input, select, button{
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  font-size: 14px;
  margin-bottom: 10px;
}

input[readonly]{
  background: #f1f5f9;
}

button{
  background: #1a56db;
  color: #fff;
  font-weight: 600;
  border: none;
}

button:active{
  transform: scale(.98);
}

/* ===== TABLE ===== */
table{
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

th, td{
  padding: 8px 6px;
  border-bottom: 1px solid #e5e7eb;
}

th{
  background: #f1f5ff;
  color: #1a56db;
  text-align: left;
}

.badge-lunas{ color:#16a34a; font-weight:600 }
.badge-belum{ color:#dc2626; font-weight:600 }

.row-belum-lunas { background:#fee2e2; }
.row-lunas { background:#dcfce7; }
.row-belum { background:#fef9c3; }
.row-selesai { background:#e5e7eb; }


/* ===== TABLE WRAPPER (KUNCI UTAMA) ===== */
.table-wrap{
  width: 100%;
  max-width: 100%;
  overflow-x: auto;   /* scroll ke samping */
  overflow-y: auto;   /* scroll ke bawah */
  -webkit-overflow-scrolling: touch;

  border-radius: 10px;
}

/* ===== TABLE ===== */
.table-wrap table{
  width: 100%;
  min-width: 600px;   /* ⬅️ INI KUNCI: paksa kolom tidak remuk */
  border-collapse: collapse;
  font-size: 14px;
}

/* ===== CELL ===== */
.table-wrap th,
.table-wrap td{
  padding: 8px 6px;
  border-bottom: 1px solid #e5e7eb;
  white-space: nowrap;  /* teks tidak memaksa wrap */
  text-align: left;
}

/* ===== HEADER TABLE ===== */
.table-wrap th{
  position: sticky;
  top: 0;
  background: #f1f5ff;
  color: #1a56db;
  z-index: 2;
}

</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="app-header">
  <div class="app-brand">
    <img src="logo.png" alt="Logo">
    <span>Kasir Alkes PKY</span>
  </div>

  <div class="app-menu">

    <!-- KASIR -->
    <a href="index.html">
      <svg viewBox="0 0 24 24">
        <rect x="3" y="4" width="18" height="6" rx="2"/>
        <path d="M4 10h16l-1.5 8a2 2 0 0 1-2 1.6H7.5a2 2 0 0 1-2-1.6L4 10Z"/>
        <circle cx="9" cy="21" r="1"/>
        <circle cx="15" cy="21" r="1"/>
      </svg>
      <span>Kasir</span>
    </a>

    <!-- INPUT / KEUANGAN -->
    <a href="Keuangan.html">
      <svg viewBox="0 0 24 24">
        <rect x="4" y="3" width="16" height="18" rx="2"/>
        <path d="M8 7h8M8 11h8M8 15h5"/>
      </svg>
      <span>Input</span>
    </a>

    <!-- TRANSAKSI -->
    <a href="transaksi.html">
      <svg viewBox="0 0 24 24">
        <path d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
      <span>Transaksi</span>
    </a>

    <!-- ✅ PESANAN (BARU) -->
    <a href="pesanan.html" class="active">
      <svg viewBox="0 0 24 24">
        <path d="M6 2h12l2 4v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6l2-4Z"/>
        <path d="M6 6h12M9 10h6M9 14h6"/>
      </svg>
      <span>Pesanan</span>
    </a>

  </div>
</div>

<!-- ===== INPUT PESANAN ===== -->
<div class="card">
  <h3>Input Pesanan</h3>

  <input type="date" id="tanggal">
  <input type="text" id="nama" placeholder="Nama Pemesan">

 <div style="position:relative">
  <input type="text" id="barang" placeholder="Cari nama barang..."
    oninput="filterBarang()" autocomplete="off">
  <div id="suggestBarang"
       style="position:absolute;top:100%;left:0;right:0;
              background:#fff;border:1px solid #e5e7eb;
              max-height:180px;overflow:auto;display:none;
              z-index:99;border-radius:8px">
  </div>
</div>

  <label style="font-size:13px;color:#64748b;display:block;margin-bottom:4px">
  Harga
</label>
<input type="number" id="harga" placeholder="Harga Barang">


  <select id="status">
    <option disabled selected>Status Pembayaran</option>
   <option value="Belum">Belum</option>
  <option value="Lunas">Lunas</option>
  </select>

 <select id="keterangan">
  <option disabled selected>Proses Pesanan</option>
  <option>Belum</option>
  <option>Selesai</option>
</select>


  <button onclick="kirimPesanan()">Kirim Pesanan</button>
</div>

<!-- ===== LIST PESANAN ===== -->
<div class="card">
  <h3>Proses Pesanan</h3>
<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Nama</th>
        <th>Barang</th>
<th>Harga</th>
<th>Pembayaran</th>

        <th>Proses Pesanan</th>
      </tr>
    </thead>
    <tbody id="listPesanan"></tbody>
  </table>
</div>
</div>
<script>
const API_URL="https://script.google.com/macros/s/AKfycbz3XTARB3Vd1pANXA5MZ1KqbquHLRC4eO3K6uZENRxfjtvnE1Nb7gv0AHEkxqDxyejGtA/exec";

// tanggal default hari ini
document.getElementById("tanggal").value =
  new Date().toISOString().split("T")[0];

// =======================
// AUTOCOMPLETE BARANG
// =======================
let dataBarang = [];

function loadBarang(){
  fetch(API_URL+"?action=barang")
    .then(r=>r.json())
    .then(d=>{
      dataBarang = d;
    });
}

function filterBarang(){
  const q = barang.value.toLowerCase();
  const box = document.getElementById("suggestBarang");
  box.innerHTML = "";

  if (!q) {
    box.style.display = "none";
    return;
  }

  const hasil = dataBarang.filter(b =>
    b.nama.toLowerCase().includes(q)
  );

  hasil.forEach(b=>{
    const div = document.createElement("div");
    div.style.padding="8px";
    div.style.cursor="pointer";
    div.innerText = b.nama;

    div.onclick = () => {
      barang.value = b.nama;
      harga.value = b.jual;
      box.style.display = "none";
    };

    box.appendChild(div);
  });

  box.style.display = hasil.length ? "block" : "none";
}

// =======================
// SIMPAN PESANAN
// =======================
function kirimPesanan(){
  const f=new FormData();
  f.append("action","simpan_pesanan");
  f.append("tanggal",tanggal.value);
  f.append("nama",nama.value);
  f.append("barang",barang.value);
  f.append("harga",harga.value);
 f.append("status", status.value || "Belum");
  f.append("keterangan",keterangan.value);

  fetch(API_URL,{method:"POST",body:f})
    .then(()=>{
      loadPesanan();
      nama.value="";
      barang.value="";
      harga.value="";
      alert("Pesanan tersimpan");
    });
}

  function formatTanggalID(tgl){
  if (!tgl) return "";

  const d = new Date(tgl);

  const day   = d.getDate();          // 4
  const month = d.getMonth() + 1;     // 1
  const year  = d.getFullYear() % 100; // 26

  return `${day}/${month}/${year}`;
}


// =======================
// LOAD PESANAN + HIGHLIGHT
// =======================
function loadPesanan(){
  fetch(API_URL+"?action=pesanan")
    .then(r=>r.json())
    .then(d=>{
      listPesanan.innerHTML="";
      d.forEach(p=>{

        let rowClass="";
        if (p.status==="Belum") rowClass="row-belum-lunas";
        else if (p.keterangan==="Selesai") rowClass="row-selesai";
        else if (p.status==="Lunas") rowClass="row-lunas";

        // FORMAT TANGGAL INDONESIA
        const tglID = formatTanggalID(p.tanggal);

        listPesanan.innerHTML+=`
        <tr class="${rowClass}">
          <td>${tglID}</td>
          <td>${p.nama}</td>
          <td>${p.barang}</td>
          <td>Rp ${Number(p.harga).toLocaleString("id-ID")}</td>
          <td>
            <select onchange="updatePesanan(${p.row},this.value,'${p.keterangan}')">
              <option value="Belum" ${p.status=="Belum"?"selected":""}>Belum</option>
              <option value="Lunas" ${p.status=="Lunas"?"selected":""}>Lunas</option>
            </select>
          </td>
          <td>
            <select onchange="updatePesanan(${p.row},'${p.status}',this.value)">
              <option value="Belum" ${p.keterangan=="Belum"?"selected":""}>Belum</option>
              <option value="Selesai" ${p.keterangan=="Selesai"?"selected":""}>Selesai</option>
            </select>
          </td>
        </tr>`;
      });
    });
}


function updatePesanan(row,status,ket,harga){
  const f=new FormData();
  f.append("action","update_pesanan");
  f.append("row",row);
  f.append("status",status);
  f.append("keterangan",ket);
  f.append("harga",harga);
  fetch(API_URL,{method:"POST",body:f});
}


// INIT
loadBarang();
loadPesanan();
</script>


</body>
</html>
