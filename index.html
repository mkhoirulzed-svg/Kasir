<!DOCTYPE html>
<html lang="id">
<head>
<!-- ===== PWA & ICON ===== -->
<link rel="icon" type="image/png" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a56db">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kasir Alkes PKY</title>

<!-- ===== LIBRARY ===== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap">

<style>
body {
    margin:0;
    font-family:'Inter',sans-serif;
    background:#e9f2ff;
    padding:15px;
    padding-top:120px; /* ruang header */
}
h2 { text-align:center; color:#1a56db; }

/* ===== APP HEADER ===== */
.app-header {
    position: fixed;
    top: 0; left: 0; right: 0;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    padding: 10px 12px 0;
    border-bottom: 1px solid #e5e7eb;
    z-index: 1000;
}
.app-brand {
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:600;
    color:#1a56db;
    margin-bottom:6px;
}
.app-brand img { height:32px; }
.app-menu { display:flex; }
.app-menu a {
    flex:1;
    padding:10px 0;
    text-align:center;
    text-decoration:none;
    color:#64748b;
    font-size:14px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:4px;
}
.app-menu a svg {
    width:20px;
    height:20px;
    stroke:currentColor;
    fill:none;
    stroke-width:2;
}
.app-menu a.active {
    color:#1a56db;
    border-bottom:3px solid #1a56db;
}

/* ===== KASIR STYLE ASLI ===== */
.card {
    background:#fff;
    padding:15px;
    border-radius:12px;
    box-shadow:0 3px 10px rgba(0,0,0,.1);
    margin-bottom:20px;
}
input,select {
    width:100%;
    padding:12px;
    margin:6px 0;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
}
.btn {
    width:100%;
    padding:14px;
    border:none;
    border-radius:8px;
    font-size:18px;
    font-weight:bold;
    margin-top:10px;
    background:#1a56db;
    color:#fff;
    cursor:pointer;
}
table { width:100%; font-size:15px; }
td { padding:6px 0; }
.right { text-align:right; }
.total-box {
    text-align:right;
    font-size:20px;
    font-weight:bold;
    color:#1a56db;
}
.btn-danger {
    background:#ef4444;
    padding:6px 10px;
    font-size:14px;
}
.btn-wa { background:#25D366; }
.small-input {
    width:70px;
    display:inline-block;
}
.toggle-btn {
    background:#f1f5ff;
    color:#1a56db;
    border:1px dashed #1a56db;
    font-size:15px;
}
.manual-box {
    display:none;
    margin-top:10px;
}
</style>
</head>

<body>

<!-- ===== HEADER + MENU ===== -->
<div class="app-header">
  <div class="app-brand">
    <img src="logo.png" alt="Logo">
    <span>Kasir Alkes PKY</span>
  </div>

  <div class="app-menu">

    <!-- KASIR -->
    <a href="index.html" class="active">
      <svg viewBox="0 0 24 24">
        <rect x="3" y="4" width="18" height="6" rx="2"/>
        <path d="M4 10h16l-1.5 8a2 2 0 0 1-2 1.6H7.5a2 2 0 0 1-2-1.6L4 10Z"/>
        <circle cx="9" cy="21" r="1"/>
        <circle cx="15" cy="21" r="1"/>
      </svg>
      <span>Kasir</span>
    </a>

    <!-- INPUT / KEUANGAN -->
    <a href="Keuangan.html">
      <svg viewBox="0 0 24 24">
        <rect x="4" y="3" width="16" height="18" rx="2"/>
        <path d="M8 7h8M8 11h8M8 15h5"/>
      </svg>
      <span>Input</span>
    </a>

    <!-- TRANSAKSI -->
    <a href="transaksi.html">
      <svg viewBox="0 0 24 24">
        <path d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
      <span>Transaksi</span>
    </a>

    <!-- âœ… PESANAN (BARU) -->
    <a href="pesanan.html" >
      <svg viewBox="0 0 24 24">
        <path d="M6 2h12l2 4v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6l2-4Z"/>
        <path d="M6 6h12M9 10h6M9 14h6"/>
      </svg>
      <span>Pesanan</span>
    </a>

  </div>
</div>

<!-- ===== INPUT BARANG DATABASE ===== -->
<div class="card">
    <input id="search" placeholder="Cari nama / barcode..." oninput="cariBarang()">
    <select id="listBarang"></select>
    <input id="qty" type="number" value="1" min="1">
    <button class="btn" onclick="tambah()">Tambah ke Keranjang</button>

    <button class="btn toggle-btn" onclick="toggleManual()">âž• Tambah Barang Manual</button>

    <div id="manualBox" class="manual-box">
        <input id="manualNama" placeholder="Nama Barang">
        <input id="manualHarga" type="number" placeholder="Harga">
        <input id="manualQty" type="number" value="1" min="1">
        <button class="btn" onclick="tambahManual()">Simpan Barang Manual</button>
    </div>
</div>

<!-- ===== KERANJANG ===== -->
<div class="card">
    <h3>Keranjang</h3>
    <table id="keranjangList"></table>

    <input id="diskon" type="number" placeholder="Diskon">
    <select id="diskonTipe">
        <option value="rp">Diskon Rupiah</option>
        <option value="persen">Diskon Persen (%)</option>
    </select>

    <div class="total-box">
        Total: <span id="total">Rp 0</span>
    </div>

    <button class="btn" onclick="cetakStruk()">ðŸ§¾ Cetak Struk</button>
    <button class="btn btn-wa" onclick="kirimWA()">Kirim WhatsApp</button>
</div>

<!-- ===== SCRIPT ASLI (TIDAK DIUBAH) ===== -->
<script src="excel.js"></script>
<script>
/* === SEMUA SCRIPT KASIR ASLI KAMU UTUH === */
let database = [];
let keranjang = [];
readExcel("data.xlsx", data => { database = data; renderSelect(); });
function renderSelect(){ listBarang.innerHTML = database.map(b =>
`<option value="${b.nama}" data-harga="${b.harga}">${b.nama} - Rp ${b.harga.toLocaleString()}</option>`).join(""); }
function cariBarang(){
let q = search.value.toLowerCase();
listBarang.innerHTML = database.filter(b =>
b.nama.toLowerCase().includes(q) ||
(b.kode && b.kode.toString().includes(q))
).map(b =>
`<option value="${b.nama}" data-harga="${b.harga}">${b.nama} - Rp ${b.harga.toLocaleString()}</option>`).join("");
}
function tambah(){
let opt = listBarang.selectedOptions[0];
keranjang.push({ nama: opt.value, harga: Number(opt.dataset.harga), qty: Number(qty.value) });
renderKeranjang();
}
function tambahManual(){
if(!manualNama.value || !manualHarga.value) return alert("Lengkapi data barang manual");
keranjang.push({ nama: manualNama.value, harga: Number(manualHarga.value), qty: Number(manualQty.value) });
manualNama.value=""; manualHarga.value=""; manualQty.value=1; renderKeranjang();
}
function toggleManual(){
manualBox.style.display = manualBox.style.display==="block" ? "none" : "block";
}
function renderKeranjang(){
let total=0;
keranjangList.innerHTML = keranjang.map((b,i)=>{
let sub=b.qty*b.harga; total+=sub;
return `<tr><td><strong>${b.nama}</strong><br>
Qty <input class="small-input" type="number" value="${b.qty}" onchange="ubahQty(${i},this.value)">
Harga <input class="small-input" type="number" value="${b.harga}" onchange="ubahHarga(${i},this.value)">
<button class="btn-danger" onclick="hapusItem(${i})">X</button></td>
<td class="right">Rp ${sub.toLocaleString()}</td></tr>`;
}).join("");
let pot=hitungDiskon(total);
total.innerText="Rp "+(total-pot).toLocaleString();
}
function ubahQty(i,v){ keranjang[i].qty=Number(v); renderKeranjang(); }
function ubahHarga(i,v){ keranjang[i].harga=Number(v); renderKeranjang(); }
function hapusItem(i){ if(confirm("Hapus item?")){ keranjang.splice(i,1); renderKeranjang(); } }
diskon.oninput = diskonTipe.onchange = renderKeranjang;
function hitungDiskon(t){ let d=Number(diskon.value||0); return diskonTipe.value==="persen"?t*d/100:d; }
function cetakStruk(){
let s=keranjang.reduce((a,b)=>a+b.qty*b.harga,0);
let p=hitungDiskon(s);
localStorage.setItem("strukData",JSON.stringify({items:keranjang,subtotal:s,diskon:p,total:s-p}));
location.href="struk.html";
}
function kirimWA(){
if(!keranjang.length) return alert("Keranjang kosong");
let t="",total=0;
keranjang.forEach(b=>{let s=b.qty*b.harga; total+=s; t+=`${b.qty}x ${b.nama} = Rp ${s.toLocaleString()}\n`;});
let p=hitungDiskon(total);
t+=`\nSubtotal : Rp ${total.toLocaleString()}\nDiskon : Rp ${p.toLocaleString()}\nTOTAL : Rp ${(total-p).toLocaleString()}`;
open(`https://wa.me/?text=${encodeURIComponent(t)}`);
}
if("serviceWorker" in navigator){ navigator.serviceWorker.register("sw.js"); }
</script>

</body>
</html>
