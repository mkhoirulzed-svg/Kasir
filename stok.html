<!DOCTYPE html>
<html lang="id">
<head>
<!-- ===== PWA & ICON ===== -->
<link rel="icon" type="image/png" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a56db">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stok Barang - Alkes PKY</title>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap">

<style>
/* ===== GLOBAL ===== */
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:#e9f2ff;
  padding:15px;
  padding-top:120px;
}

/* ===== HEADER ===== */
.app-header{
  position:fixed;
  top:0;left:0;right:0;
  background:#fff;
  display:flex;
  flex-direction:column;
  padding:10px 12px 0;
  border-bottom:1px solid #e5e7eb;
  z-index:1000;
}
.app-brand{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:600;
  color:#1a56db;
  margin-bottom:6px;
}
.app-brand img{ height:32px; }
.app-menu{ display:flex; }
.app-menu a{
  flex:1;
  padding:10px 0;
  text-align:center;
  text-decoration:none;
  color:#64748b;
  font-size:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:4px;
}
.app-menu a svg{
  width:20px;height:20px;
  stroke:currentColor;
  fill:none;
  stroke-width:2;
}
.app-menu a.active{
  color:#1a56db;
  border-bottom:3px solid #1a56db;
}

/* ===== CARD ===== */
.card{
  background:#fff;
  padding:15px;
  border-radius:12px;
  box-shadow:0 3px 10px rgba(0,0,0,.1);
  margin-bottom:15px;
}

.stok-item{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:10px;
}

.stok-item input{
  width:70px;
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
}

.stok-item button{
  padding:8px 10px;
  border-radius:6px;
  border:none;
  background:#1a56db;
  color:#fff;
  font-size:13px;
}

.stok-nama{
  flex:1;
  font-size:14px;
}

.stok-habis{
  color:#dc2626;
  font-weight:600;
}

.pagination{
  display:flex;
  gap:6px;
  justify-content:center;
  margin-top:15px;
}
.pagination button{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid #ccc;
  background:#fff;
}
.pagination button.active{
  background:#1a56db;
  color:#fff;
  border-color:#1a56db;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="app-header">
  <div class="app-brand">
    <img src="logo.png">
    <span>Kasir Alkes PKY</span>
  </div>

  <div class="app-menu">
    <a href="index.html">
      <svg viewBox="0 0 24 24">
        <rect x="3" y="4" width="18" height="6" rx="2"/>
        <path d="M4 10h16l-1.5 8a2 2 0 0 1-2 1.6H7.5a2 2 0 0 1-2-1.6L4 10Z"/>
      </svg>
      <span>Kasir</span>
    </a>

    <a href="stok.html" class="active">
      <svg viewBox="0 0 24 24">
        <path d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
      <span>Stok</span>
    </a>

    <a href="transaksi.html">
      <svg viewBox="0 0 24 24">
        <path d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
      <span>Transaksi</span>
    </a>
  </div>
</div>

<!-- ===== LIST STOK ===== -->
<div class="card">
  <h3>Daftar Stok Barang</h3>
  <div style="display:flex; gap:8px; margin-bottom:12px;">
  <input 
    type="text" 
    id="searchBox" 
    placeholder="Cari barang..." 
    oninput="filterData()"
    style="flex:1; padding:8px; border-radius:6px; border:1px solid #ccc;"
  >
  <button onclick="toggleMode()" id="modeBtn"
    style="padding:8px 12px; border-radius:6px; border:none; background:#16a34a; color:#fff;">
    Mode Edit
  </button>
</div>

  <div id="stokList"></div>

  <div class="pagination" id="pagination"></div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbz3XTARB3Vd1pANXA5MZ1KqbquHLRC4eO3K6uZENRxfjtvnE1Nb7gv0AHEkxqDxyejGtA/exec";

const PER_PAGE = 30;
let data = [];
let page = 1;

fetch(API_URL+"?action=stok")
  .then(r=>r.json())
  .then(d=>{
    data = d || [];
    filteredData = data;
    render();
  });

  function filterData(){
  const q = searchBox.value.toLowerCase();
  filteredData = data.filter(b => 
    b.nama.toLowerCase().includes(q)
  );
  page = 1;
  render();
}

  function toggleMode(){
  modeEdit = !modeEdit;
  modeBtn.textContent = modeEdit ? "Mode Lihat" : "Mode Edit";
  modeBtn.style.background = modeEdit ? "#dc2626" : "#16a34a";
  render();
}


function render(){
  const start = (page-1)*PER_PAGE;
  const end   = start+PER_PAGE;
  const slice = filteredData.slice(start,end);

  stokList.innerHTML="";
  slice.forEach(b=>{
    const row=document.createElement("div");
    row.className="stok-item";

    const nama=document.createElement("div");
    nama.className="stok-nama"+(b.stok==0?" stok-habis":"");
    nama.textContent=b.nama;

    const input=document.createElement("input");
    input.type="number";
    input.value=b.stok;
    input.disabled = !modeEdit;

    if(!modeEdit){
      input.style.background="#f1f5f9";
    }

    row.appendChild(nama);
    row.appendChild(input);

    if(modeEdit){
      const btn=document.createElement("button");
      btn.textContent="Simpan";
      btn.onclick=()=>simpan(b.row,input.value);
      row.appendChild(btn);
    }

    stokList.appendChild(row);
  });

 const total = Math.ceil(filteredData.length / PER_PAGE);
}

function renderPagination(){
  pagination.innerHTML="";
  const total=Math.ceil(data.length/PER_PAGE);

  const prev=document.createElement("button");
  prev.textContent="Prev";
  prev.onclick=()=>{ if(page>1){page--;render();} };
  pagination.appendChild(prev);

  for(let i=1;i<=total;i++){
    const b=document.createElement("button");
    b.textContent=i;
    if(i===page) b.classList.add("active");
    b.onclick=()=>{page=i;render();};
    pagination.appendChild(b);
  }

  const next=document.createElement("button");
  next.textContent="Next";
  next.onclick=()=>{ if(page<total){page++;render();} };
  pagination.appendChild(next);
}

function simpan(row,stok){
  const p=new URLSearchParams();
  p.append("action","updateStok");
  p.append("row",row);
  p.append("stok",stok);

  fetch(API_URL,{method:"POST",body:p})
    .then(()=>alert("Stok diperbarui"));
}
</script>

</body>
</html>

